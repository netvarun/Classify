/*!
 * Classify JavaScript Library v0.8.0
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Thu, 26 Apr 2012 21:01:52 GMT
 */;(function(a,b){"use strict";var c="prototype",d="string",e=function(){var a;for(a in{toString:1})if(a==="toString")return!1;return!0}(),f=e?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],g=f.length,h=Object[c],i=h.toString,j=h.hasOwnProperty,k=function(a){return typeof a=="function"},l=function(a){return a&&a[c]&&i.call(a)==="[object Function]"},m=Array.isArray||function(a){return i.call(a)==="[object Array]"},n=function(a){var b=[],c;for(c in a)b.push(c);if(e)for(c=0;c<g;c++)a.hasOwnProperty(f[c])&&b.push(f[c]);return b},o=function(a){return m(a)?a:[a]},p=function(a){return Array[c].slice.call(a,0)},q=Array[c].indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c=0,d=a.length;for(;c<d;c++)if(a[c]===b)return c;return-1},r=function(a,b){return a.__original_=b,a},s=function(a,c,d){if(!a)return a;var e,f=0,g=a.length;if(g===b||k(a)){for(e in a)if(c.call(d||a[e],a[e],e,a)===!1)break}else for(e=a[0];f<g;e=a[++f])if(c.call(d||e,e,f,a)===!1)break;return a},t=function(a,b){var c=[];return s(a,function(d,e){c[c.length]=b(d,e,a)}),c},u=function(a,b){var c=[];return s(a,function(a){a!==b&&(c[c.length]=a)}),c},v=function(){var a=p(arguments),b=a.shift();return s(a,function(a){s(n(a),function(c){b[c]=a[c]})}),b},w=/^__static_/,x=/^__observable_/,y=/^__static_(?:superclass|subclass|implement|observables|Extend|prototype|subclass|applicate|addProperty|removeProperty|addStaticProperty|addObservableProperty|removeObservableProperty)$/,z=function(){var a=function(){};return a[c].init=function(){},a.superclass=null,a.subclass=[],a.implement=[],a.observables={},a[c].constructor=z,a[c].self=z,a.__isclass_=!0,a}(),A=function(a,c){return r(function(){var d=this.parent,e;return this.parent=a,e=c.apply(this,arguments),d===b?delete this.parent:this.parent=d,e},c)},B=function(a,b,d,e){if(e===h[d])return;if(w.test(d))a[d.replace(w,"")]=k(e)?r(function(){return e.apply(a,arguments)},e):e;else if(x.test(d))d=d.replace(x,""),a.observables[d]=e,s(a.subclass,function(a){j.call(a.observables,d)||a.addObservableProperty(d,e)});else{var f=b[c][d],g=a[c];g[d]=k(e)&&k(f)?A(f,e):e,k(e)&&s(a.subclass,function(a){k(a[c][d])&&!a[c][d].__original_&&(a[c][d]=A(g,a[c][d]))})}},C=function(a,b){if(a[b]&&a[b]===h[b]||y.test(b))return;if(w.test(b)){b=b.replace(w,""),a[b]=null;try{delete a[b]}catch(d){}}else if(x.test(b)){b=b.replace(x,"");var e=a.observables[b];s(a.subclass,function(a){a.observables[b]===e&&a.removeObservableProperty(b)}),a.observables[b]=null;try{delete a.observables[b]}catch(d){}}else{if(!k(a[c][b])){a[c][b]=null;try{delete a[c][b]}catch(d){}return}s(a.subclass,function(a){a[c][b]&&k(a[c][b])&&k(a[c][b].__original_)&&(a[c][b]=a[c][b].__original_)}),a[c][b]=null;try{delete a[c][b]}catch(d){}}},D=function(){var a=z,d={},e=[],f=arguments,g=f.length;g===1?d=f[0]:g===2?(!f[0].__isclass_&&!l(f[0])?e=o(f[0]):a=f[0],d=f[1]):(a=f[0],e=o(f[1]),d=f[2]),!a.__isclass_&&!d.init&&(d.init=a);var h=function(){var a;if(!this||!this.init||!(this instanceof h))return h.invoke.apply(h,arguments);for(a in h.observables)j.call(h.observables,a)&&(this[a]=new E(this,a,h.observables[a]));var c=this.init.apply(this,arguments);if(c!==b)return c};delete d.applicate,h.applicate=function(a){var b=function(){return h.apply(this,a)};return b[c]=h[c],new b},h.invoke=d.invoke||(a.invoke&&!a.invoke.__original_?a.invoke:null)||r(function(){return h.applicate(arguments)},!0),delete d.invoke,h.superclass=a,h.subclass=[],h.implement=(a.implement||[]).concat(e),h.observables=v({},a.observables),h.Extend=h[c].Extend=function(a){return D(h,a)};var i=function(){};i[c]=a[c];var m=i[c];return h[c]=new i,a.subclass&&a.subclass.push(h),d.invoke=function(a,b){if(a in m&&a!=="invoke"&&k(m[a])){var c=this.invoke,d;return this.invoke=m.invoke,d=m[a].apply(this,b||[]),this.invoke=c,d}throw Error('Function "'+a+'" of parent class being invoked is undefined.')},h.addProperty=function(a,c,d){return d=d||"",c===b?s(n(a),function(b){B(h,i,d+b,a[b])}):B(h,i,d+a,c),h},h.removeProperty=function(a){return C(h,a),h},h.addStaticProperty=function(a,b){return h.addProperty(a,b,"__static_")},h.removeStaticProperty=function(a){return h.removeProperty("__static_"+a)},h.addObservableProperty=function(a,b){return h.addProperty(a,b,"__observable_")},h.removeObservableProperty=function(a){return h.removeProperty("__observable_"+a)},e.length!==0&&s(e,function(a){var e=a.__isclass_?a[c]:a;s(n(e),function(a){h[c][a]===b&&d[a]===b&&h.addProperty(a,e[a])})}),h.addProperty(d),h[c].constructor=h,h[c].self=h,h.__isclass_=!0,h},E=D({init:function(a,b,c){if(!a)throw Error("Cannot create Observer without class context.");this.context=a,this.name=b,this.events=[],this.writable=!0,c!==null&&typeof c=="object"?(this.getter=k(c.get)?c.get:null,this.setter=k(c.set)?c.set:null,this.value=c.value,this.writable=typeof c.writable=="boolean"?c.writable:!0):this.value=c},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(a){var b=0,c=this.events.length,d=this.value;if(!this.writable)return this.context;this.value=this.setter?this.setter.call(this.context,a,d):a;if(this.value!==d)for(;b<c;b++)this.events[b].call(this.context,a,d);return this.context},addListener:function(a){if(!k(a))throw Error("addListener only takes instances of Function");return this.events.push(a),this.context},removeListener:function(a){if(!k(a))throw Error("removeListener only takes instances of Function");var b=q(this.events,a);return b<0?this.context:(this.events.splice(b,1),this.context)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}}),F={},G="GLOBAL",H,I,J,K,L=function(a,b){return s(a,function(a){b[a]||(b[a]={}),b=b[a]}),b},M=function(a,b,c){if(typeof b===d){c=a[b]||K().get(b)||null;if(!c)throw Error("Invalid parent class ["+b+"] specified.");return c}return m(b)?t(b,function(b){return M(a,b)}):b},N=D({init:function(a){this.ref={},this.name=a},create:function(){var a=p(arguments),b=a.shift(),c=b.split("."),d=c.pop(),e=this,f=L(c,e),g=e.ref,h=D.apply(null,t(a,function(a){return M(g,a)}));return h._name_=d,h._namespace_=b,h.getNamespace=function(){return e},h.toString=function(){return"[object "+b+"]"},f[d]=h,g[b]=h,h},destroy:function(a){var b,c=a.split("."),d=c.pop(),e=this,f=this,g=this.ref;return s(c,function(a){if(!f[a])return f=null,this;f=f[a]}),f?(b=f[d],s(b.subclass,function(a){e.destroy(a._namespace_)}),b.superclass.subclass&&(b.superclass.subclass=u(b.superclass.subclass,b)),s(g,function(b,c){c!==a&&c.indexOf(a)===0&&e.destroy(b._namespace_)}),delete f[d],delete g[a],this):this},exists:function(a){return!!this.ref[a]},get:function(a,b){return k(b)?(this.ref[a]?b(this.ref[a]):this.load(a,b),this):this.ref[a]||this.name!==G&&K().get(a)||null},load:function(a,b){return b&&b(this.ref[a]||null),this},setAutoloader:function(a){return k(a)?(this.load=a,this):this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});H=function(a){return a instanceof N?a:(a=a||G,F[a]||(F[a]=new N(a)),F[a])},I=function(a){if(a===G)return;delete F[a]},J=function(a){var b=a.split("."),c=b.length,d;while((d=b.slice(0,c--).join("."))!=="")if(F[d])return F[d];return null},K=function(){return H(G)};var O="/",P=D({invoke:function(){var a=p(arguments),b=a.length,c,e;if(b===0)return H();if(typeof a[0]===d)return b===1?(e=a[0].split(O),c=H(e[0]),e[1]?c.get(e[1]):c):b===2&&typeof a[1]===d?H(a[0]).get(a[1]):(e=a.shift().split(O),c=H(e[0]),e[1]&&a.unshift(e[1]),c.create.apply(c,a));return D.apply(null,a)},init:function(){var a=p(arguments),b,c;if(a.length<1)throw Error("Classify object cannot be instantiated!");return b=m(a[a.length-1])?a.pop():[],c=P.invoke.apply(null,a),c.__isclass_?c.applicate(b):c}});v(P,{version:"0.8.0",create:D,Namespace:N,getNamespace:H,destroyNamespace:I,testNamespace:J,getGlobalNamespace:K,Observer:E,extend:v,provide:function(b,c){return L(b.split("."),c||a||{})}});if(typeof a.module!="undefined"&&a.module.exports)a.module.exports=P,P.Classify=P;else if(typeof a.define=="function"&&a.define.amd)a.define("classify",function(){return P});else{var Q=a.Classify;a.Classify=P,P.noConflict=function(){return Q===b?delete a.Classify:a.Classify=Q,P}}})(this);