/*!
 * Classify JavaScript Library v0.10.1
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Tue, 25 Sep 2012 20:43:28 GMT
 */;(function(e,t){"use strict";var n,r,i,s,o,u,a,f,l,c,h,p,d,v="prototype",m=!{toString:null}.propertyIsEnumerable("toString"),g=m?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],y=g.length,b=Object[v],w=b.toString,E=b.hasOwnProperty,S=/^(?:boolean|number|string|undefined)$/,x=function(e){return e===null||S.test(typeof e)},T=function(e){return w.call(e)==="[object Function]"},N=function(e){return e&&e[v]&&T(e)},C=Array.isArray||function(e){return w.call(e)==="[object Array]"},k=/^\s*function\s+.+?\(.*?\)\s*\{\s*\[native code\]\s*\}\s*$/,L=function(e){return T(e)&&k.test(e+"")},A=function(e){var t=[],n;for(n in e)t[t.length]=n;if(m)for(n=0;n<y;++n)E.call(e,g[n])&&(t[t.length]=g[n]);return t},O=function(e){return C(e)?e:[e]},M=function(e){return Array[v].slice.call(e,0)},_=Array[v].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n=0,r=e.length;for(;n<r;++n)if(e[n]===t)return n;return-1},D=function(e,t){return e.__original_=t,e},P=function(e,n,r){if(!e)return e;var i,s=0,o=e.length,u;if(o===t||T(e)){u=A(e),o=u.length;for(i=e[u[0]];s<o;i=e[u[++s]])if(n.call(r||i,i,u[s],e)===!1)break}else for(i=e[0];s<o;i=e[++s])if(n.call(r||i,i,s,e)===!1)break;return e},H=function(e,t){var n=[];return P(e,function(r,i){n[n.length]=t(r,i,e)}),n},B=function(e,t){var n=[];return P(e,function(e){e!==t&&(n[n.length]=e)}),n},j=function(){var e=M(arguments),t=e.shift();return P(e,function(e){P(A(e),function(n){t[n]=e[n]})}),t},F=/^(?:superclass|subclass|implement|observable|bindings|extend|prototype|applicate|(?:add|remove)(?:Static|Observable|Aliased|Bound)Property)$/,I=/^__/,q={},R=[],U=[],z=[],W=[],X=[R,U,z,W],V=["onCreate","onPropAdd","onPropRemove","onInit"],$=L(Object.create)?Object.create:function(e,t){var n=function(){};return n[v]=e,new n},J=function(e,t,n){e[t]=n},K=function(){var e=function(){};return e[v].init=function(){},e.superclass=null,e.subclass=[],e.implement=[],e[v].constructor=K,e[v].self=K,e.__isclass_=!0,e}(),Q=function(e,n){return D(function(){var r=this.parent,i;return this.parent=e,i=n.apply(this,arguments),r===t?delete this.parent:this.parent=r,i},n)},G=function(e,t){if(q[e])throw Error('Adding duplicate mutator "'+e+'".');q[e]=t,t.name=e,t.propTest=RegExp("^__"+e+"_"),t.propPrefix="__"+e+"_",P(V,function(e,n){t[e]&&X[n].push(t)})},Y=function(e){var t=q[e];if(!t)throw Error("Removing unknown mutator.");P(V,function(e,n){if(t[e]){var r=_(X[n],t);r>-1&&X[n].splice(r,1)}}),q[e]=null;try{delete q[e]}catch(n){}},Z=function(e,t,n,r){var i,s,o;if(r===b[n])return;if(I.test(n)){i=!1,P(U,function(s){if(s.propTest.test(n))return n===s.propPrefix?P(r,function(n,r){s.onPropAdd.call(s,e,t,r,n)}):s.onPropAdd.call(s,e,t,n.replace(s.propTest,""),r),i=!0,!1});if(i)return}s=t[v][n],o=e[v],J(o,n,T(r)&&!r.__isclass_&&T(s)?Q(s,r):r),T(r)&&P(e.subclass,function(e){T(e[v][n])&&!e[v][n].__original_&&J(e[v],n,Q(o[n],e[v][n]))})},et=function(e,t){var n=!1;if(I.test(t)){P(z,function(r){if(r.propTest.test(t))return r.onPropRemove.call(r,e,t.replace(r.propTest,"")),n=!0,!1});if(n)return}if(!T(e[v][t])){e[v][t]=null;try{delete e[v][t]}catch(r){}return}P(e.subclass,function(e){e[v][t]&&T(e[v][t])&&T(e[v][t].__original_)&&J(e[v],t,e[v][t].__original_)}),e[v][t]=null;try{delete e[v][t]}catch(r){}},tt=function(){var e=K,n={},r=[],i=arguments,s=i.length,o,u;return s===1?n=i[0]:s===2?(!i[0].__isclass_&&!N(i[0])?r=O(i[0]):e=i[0],n=i[1]):(e=i[0],r=O(i[1]),n=i[2]),n=j({},n),!e.__isclass_&&!n.init&&(n.init=e),o=function(){var e,n,r;if(!this||!this.init||!(this instanceof o))return o.invoke.apply(o,arguments);for(n=0,r=W.length;n<r;n++){e=W[n].onInit.call(W[n],this,o);if(e!==t){if(x(e))throw Error("Return values during onInit hook can only be objects.");return e}}e=this.init.apply(this,arguments);if(e!==t){if(x(e))throw Error("Return values for the constructor can only be objects.");return e}},delete n.applicate,o.applicate=function(e){var t=function(){return o.apply(this,e)};return t[v]=o[v],new t},o.invoke=n.invoke||(e.invoke&&T(e.invoke)&&!e.invoke.__original_?e.invoke:null)||D(function(){return o.applicate(arguments)},!0),delete n.invoke,o.superclass=e,o.subclass=[],o.implement=(C(e.implement)?e.implement:[]).concat(r),u=o[v]=$(e[v]),o.extend=u.extend=function(){return tt.apply(null,[o].concat(M(arguments)))},e.subclass&&C(e.subclass)&&e.subclass.push(o),n.invoke=function(t,n){if(t in e[v]&&t!=="invoke"&&T(e[v][t])){var r=this.invoke,i;return this.invoke=e[v].invoke,i=e[v][t].apply(this,n||[]),this.invoke=r,i}throw Error('Function "'+t+'" of parent class being invoked is undefined.')},o.addProperty=function(n,r,i){return i=i||"",r===t&&typeof n!="string"?P(A(n),function(t){Z(o,e,i+t,n[t])}):Z(o,e,i+n,r),o},o.removeProperty=function(e){return et(o,e),o},r.length!==0&&P(r,function(e){var t=e.__isclass_?e[v]:e;P(A(t),function(e){!E.call(u,e)&&!E.call(n,e)&&(n[e]=t[e])})}),P(R,function(t){t.onCreate.call(t,o,e)}),o.addProperty(n),u.constructor=o,u.self=o,o.__isclass_=!0,o};G("static",{onCreate:function(e){var t=this.propPrefix;e.addStaticProperty=function(n,r){return e.addProperty(n,r,t)},e.removeStaticProperty=function(n){return e.removeProperty(t+n)}},onPropAdd:function(e,t,n,r){if(F.test(n))return;J(e,n,T(r)&&!r.__isclass_?D(function(){return r.apply(e,arguments)},r):r)},onPropRemove:function(e,t){if(F.test(t))return;e[t]=null;try{delete e[t]}catch(n){}}}),G("nowrap",{onCreate:function(e){var t=this.propPrefix;e.addUnwrappedProperty=function(n,r){return e.addProperty(n,r,t)}},onPropAdd:function(e,t,n,r){J(e[v],n,r)}}),G("alias",{onCreate:function(e){var t=this.propPrefix;e.addAliasedProperty=function(n,r){return e.addProperty(n,r,t)}},onPropAdd:function(e,t,n,r){Z(e,t,n,function(){return this[r].apply(this,arguments)})}}),G("bind",{onCreate:function(e,t){var n=this;e.bindings=(t.bindings||[]).slice(0),e.addBoundProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeBoundProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){var i=_(e.bindings,n);i<0&&T(r)&&!r.__isclass_&&e.bindings.push(n),Z(e,t,n,r)},onPropRemove:function(e,t){var n=_(e.bindings,t);if(n<0)return;e.bindings.splice(n,1),P(e.subclass,function(e){_(e.bindings,t)>-1&&!E.call(e[v],t)&&e.removeBoundProperty(t)}),et(e,t)},onInit:function(e,t){var n=t.bindings||null;if(n===null||n.length===0)return;P(n,function(n){J(e,n,function(){var r=M(arguments);return r.unshift(this),t[v][n].apply(e,r)})})}}),n=tt({init:function(e,t,n){if(!e)throw Error("Cannot create Observer without class context.");this.context=e,this.name=t,this.events=[],this.writable=!0,this.delay=0,this._debounce=null,n!==null&&typeof n=="object"?(this.getter=T(n.get)?n.get:null,this.setter=T(n.set)?n.set:null,this.value=n.value,this.writable=typeof n.writable=="boolean"?n.writable:!0,this.delay=typeof n.delay=="number"?n.delay:0):this.value=n},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(e){var t=this.value,n=this.context;return this.writable?(this.value=this.setter?this.setter.call(n,e,t):e,this.value!==t&&this.emit(),n):n},emit:function(){var t=this,n=M(arguments);return this.delay>0?(this._debounce!==null&&e.clearTimeout(this._debounce),this._debounce=e.setTimeout(function(){t._debounce=null,t._triggerEmit(n)},this.delay)):this._triggerEmit(n),this.context},_triggerEmit:function(e){var t=0,n=this.events.length,r=this.context,i=this.events;e.unshift(this.value);for(;t<n;++t)i[t].apply(r,e)},addListener:function(e){if(!T(e))throw Error("Observer.addListener only takes instances of Function");return this.events[this.events.length]=e,this.context},once:function(e){if(!T(e))throw Error("Observer.once only takes instances of Function");var t=this,n=function(){t.removeListener(n),e.apply(this,arguments)};return n.listener=e,this.addListener(n),this.context},removeListener:function(e){if(!T(e))throw Error("Observer.removeListener only takes instances of Function");var t=this.context,n=this.events,r=-1,i=0,s=n.length;for(;i<s;++i)if(n[i]===e||n[i].listener&&n[i].listener===e){r=i;break}return r<0?t:(n.splice(i,1),t)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}}),n[v].on=n[v].addListener,G("observable",{onCreate:function(e,t){var n=this;e.observable=j({},t.observable||{}),e.addObservableProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeObservableProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){e.observable[n]=r,J(e[v],n,null),P(e.subclass,function(e){E.call(e.observable,n)||e.addObservableProperty(n,r)})},onPropRemove:function(e,t){var n=e.observable[t];P(e.subclass,function(e){e.observable[t]===n&&e.removeObservableProperty(t)}),e.observable[t]=null;try{delete e.observable[t]}catch(r){}},onInit:function(e,t){var r,i=t.observable||null;if(i===null)return;for(r in i)E.call(i,r)&&(e[r]=new n(e,r,i[r]))}}),r={},i="GLOBAL",f=function(e,t){return P(e,function(e){t[e]||(t[e]={}),t=t[e]}),t},l=function(e,t,n){if(typeof t=="string"){n=e[t]||a().get(t)||null;if(!n)throw Error("Invalid parent class ["+t+"] specified.");return n}return C(t)?H(t,function(t){return l(e,t)}):t},c=tt({init:function(e){this.ref={},this.name=e},create:function(){var e=M(arguments),t=e.shift(),n=t.split("."),r=n.pop(),i=this,s=f(n,i),o=i.ref,u=tt.apply(null,H(e,function(e){return l(o,e)}));return u._name_=r,u._namespace_=t,u.extend=u[v].extend=function(){return tt.apply(null,[u].concat(H(arguments,function(e){return l(o,e)})))},u.getNamespace=function(){return i},u.toString=function(){return"[object "+t+"]"},s[r]=u,o[t]=u,u},destroy:function(e){var t,n=e.split("."),r=n.pop(),i=this,s=this,o=this.ref;return P(n,function(e){if(!s[e])return s=null,!1;s=s[e]}),s?(t=s[r],t?(P(t.subclass,function(e){i.destroy(e._namespace_)}),t.superclass.subclass&&(t.superclass.subclass=B(t.superclass.subclass,t)),P(o,function(t,n){n!==e&&n.indexOf(e)===0&&i.destroy(t._namespace_)}),delete s[r],delete o[e],this):this):this},exists:function(e){return!!this.ref[e]},get:function(e,t){return T(t)?(this.ref[e]?t(this.ref[e]):this.load(e,t),this):this.ref[e]||this.name!==i&&a().get(e)||null},load:function(e,t){return t&&t(this.ref[e]||null),this},setAutoloader:function(e){if(!T(e))throw Error("Namespace.setAutoloader only takes instances of Function");return this.load=e,this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}}),s=function(e){return e instanceof c?e:(e=e||i,r[e]||(r[e]=new c(e)),r[e])},o=function(e){e instanceof c&&(e=e.name);if(e===i)return;delete r[e]},u=function(e){var t,n=e.split("."),i=n.length;while((t=n.slice(0,i--).join("."))!=="")if(r[t])return r[t];return null},a=function(){return s(i)},h="/",p=tt({invoke:function(){var e=M(arguments),t=e.length,n,r;if(t===0)return s();if(typeof e[0]=="string")return t===1?(r=e[0].split(h),n=s(r[0]),r[1]?n.get(r[1]):n):t===2&&typeof e[1]=="string"?s(e[0]).get(e[1]):(r=e.shift().split(h),n=s(r[0]),r[1]&&e.unshift(r[1]),n.create.apply(n,e));return tt.apply(null,e)},init:function(){var e=M(arguments),t,n;if(e.length<1)throw Error("Classify object cannot be instantiated!");return t=C(e[e.length-1])?e.pop():[],n=p.invoke.apply(null,e),n.__isclass_?n.applicate(t):n}}),j(p,{version:"0.10.1",create:tt,Namespace:c,getNamespace:s,destroyNamespace:o,testNamespace:u,getGlobalNamespace:a,Observer:n,addMutator:G,removeMutator:Y,global:a(),extend:j,provide:function(t,n){return f(t.split("."),n||e||{})}}),typeof module!="undefined"&&module.exports?(module.exports=p,p.Classify=p):typeof e.define=="function"&&e.define.amd?e.define("classify",function(){return p}):(d=e.Classify,e.Classify=p,p.noConflict=function(){return d===t?delete e.Classify:e.Classify=d,p})})(this);