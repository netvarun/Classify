/*!
 * Classify JavaScript Library v0.1.0
 * http://www.closedinterval.com/
 *
 * Copyright 2011, Wei Kin Huang
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Mon Jun 20 20:33:44 EDT 2011
 */
(function(a,b){var c=function(){var a;for(a in{toString:1})if(a==="toString")return!1;return!0}(),d=c?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],e=d.length,f=Object.prototype,g=f.toString,h=function(a){return typeof a=="function"},i=function(a){return g.call(a)==="[object Array]"},j=function(a){var b=[],f;for(f in a)b.push(f);if(c)for(f=0;f<e;f++)a.hasOwnProperty(d[f])&&b.push(d[f]);return b},k=function(a){return i(a)?a:[a]},l=function(a){return Array.prototype.slice.call(a,0)},m=function(a,b){a.__original_=b;return a},n=function(a,c,d){if(a==null)return a;var e,f=0,g=a.length;if(g===b||h(a)){for(e in a)if(c.call(d||a[e],a[e],e,a)===!1)break}else for(e=a[0];f<g&&c.call(d||e,e,f,a)!==!1;e=a[++f]);return a},o=function(a,b){var c=[];n(a,function(d,e){c[c.length]=b(d,e,a)});return c},p=function(a,b){var c=[];n(a,function(a){a!==b&&(c[c.length]=a)});return c},q=/^__static_/,r=function(){var a=function(){};a.prototype._construct_=function(){},a.superclass=null,a.subclass=[],a.implement=[],a.prototype.constructor=r,a.prototype._self_=r,a.__isclass_=!0;return a}(),s=function(a,c,d,e){if(e!==f[d])if(q.test(d))a[d.replace(q,"")]=h(e)?m(function(){return e.apply(a,arguments)},e):e;else{var g=c.prototype[d];a.prototype[d]=h(e)&&h(g)?m(function(){var a=this._parent_,c;this._parent_=g,c=e.apply(this,arguments),a===b?delete this._parent_:this._parent_=a;return c},e):e}},t=function(){var a=r,c={},d=[],e=arguments,f=e.length;f===1?c=e[0]:f===2?(e[0].__isclass_?a=e[0]:d=k(e[0]),c=e[1]):(a=e[0],d=k(e[1]),c=e[2]);var g=function(){if(!this._construct_)return g._invoke_.apply(g,arguments);this._construct_.apply(this,arguments)};g._invoke_=c._invoke_||function(){var a=arguments,b=function(){return g.apply(this,a)};b.prototype=g.prototype;return new b},delete c._invoke_,g.superclass=a,g.subclass=[],g.implement=a.implement.concat(d),g.Extend=g.prototype.Extend=function(a){return Class(g,a)};var i=function(){};i.prototype=a.prototype;var l=i.prototype;g.prototype=new i,a.subclass.push(g),c._invoke_=function(a,b){if(a in l&&a!=="_invoke_"&&h(l[a])){var c=this._invoke_,d;this._invoke_=l._invoke_,d=l[a].apply(this,b||[]),this._invoke_=c;return d}throw'Function "'+a+'" of parent class being invoked is undefined.'},g.addProperty=function(a,c,d){d=d||"",c===b?n(j(a),function(b){s(g,i,d+b,a[b])}):s(g,i,d+a,c);return g},g.addStaticProperty=function(a,b){return g.addProperty(a,b,"__static_")},d.length!==0&&n(d,function(a){var d=a.__isclass_?a.prototype:a;n(j(d),function(a){g.prototype[a]===b&&c[a]===b&&g.addProperty(a,d[a])})}),g.addProperty(c),g.prototype.constructor=g,g.prototype._self_=g,g.__isclass_=!0;return g},u={},v=function(a,b){n(a,function(a){b[a]||(b[a]={}),b=b[a]});return b},w=function(a,b){if(typeof b=="string"){if(!a[b])throw"Invalid parent class specified.";return a[b]}return i(b)?o(b,function(b){return w(a,b)}):b},x=t({_construct_:function(a){this.ref={},this.name=a},create:function(){var a=l(arguments),b=a.shift(),c=b.split("."),d=c.pop(),e=this,f=v(c,e),g=e.ref,h=t.apply(null,o(a,function(a){return w(g,a)}));h._name_=d,h._namespace_=b,h.getNamespace=function(){return e},h.toString=function(){return"[object "+b+"]"},f[d]=h,g[b]=h;return h},destroy:function(a){var b,c=a.split("."),d=c.pop(),e=this,f=this,g=this.ref;n(c,function(a){if(!f[a]){f=null;return this}f=f[a]});if(!f)return this;b=f[d],n(b.subclass,function(a){e.destroy(a._namespace_)}),b.superclass.subclass=p(b.superclass.subclass,b),n(g,function(b,c){c!==a&&c.indexOf(a)===0&&e.destroy(b._namespace_)}),delete f[d],delete g[a];return this},exists:function(a){return!!this.ref[a]},get:function(a,b){b&&b(this.ref[a]||null);return this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}}),y=function(a){u[a]||(u[a]=new x(a));return u[a]},z=function(a){delete u[a]},A=t({_invoke_:function(){return t.apply(null,arguments)},_construct_:function(){throw"Classify object cannot be instantiated!"}});A.Create=t,A.GetNamespace=y,A.DestroyNamespace=z,typeof module!="undefined"&&module.exports&&(module.exports=A,A.Classify=A),a.Classify=A})(this);