/*!
 * Classify JavaScript Library v0.9.6
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Sat, 19 May 2012 03:12:25 GMT
 */;(function(a,b){"use strict";var c="prototype",d=!{toString:1}.propertyIsEnumerable("toString"),e=d?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],f=e.length,g=Object[c],h=g.toString,i=g.hasOwnProperty,j=function(a){return typeof a=="function"},k=function(a){return a&&a[c]&&h.call(a)==="[object Function]"},l=Array.isArray||function(a){return h.call(a)==="[object Array]"},m=function(a){var b=[],c;for(c in a)b.push(c);if(d)for(c=0;c<f;c++)a.hasOwnProperty(e[c])&&b.push(e[c]);return b},n=function(a){return l(a)?a:[a]},o=function(a){return Array[c].slice.call(a,0)},p=Array[c].indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c=0,d=a.length;for(;c<d;c++)if(a[c]===b)return c;return-1},q=function(a,b){return a.__original_=b,a},r=function(a,c,d){if(!a)return a;var e,f=0,g=a.length;if(g===b||j(a)){for(e in a)if(c.call(d||a[e],a[e],e,a)===!1)break}else for(e=a[0];f<g;e=a[++f])if(c.call(d||e,e,f,a)===!1)break;return a},s=function(a,b){var c=[];return r(a,function(d,e){c[c.length]=b(d,e,a)}),c},t=function(a,b){var c=[];return r(a,function(a){a!==b&&(c[c.length]=a)}),c},u=function(){var a=o(arguments),b=a.shift();return r(a,function(a){r(m(a),function(c){b[c]=a[c]})}),b},v=/^(?:superclass|subclass|implement|extend|prototype|subclass|applicate|addProperty|removeProperty|addStaticProperty|addObservableProperty|removeObservableProperty|addAliasedProperty)$/,w={},x=[],y=[],z=[],A=[],B=function(){var a=function(){};return a[c].init=function(){},a.superclass=null,a.subclass=[],a.implement=[],a[c].constructor=B,a[c].self=B,a.__isclass_=!0,a}(),C=function(a,c){return q(function(){var d=this.parent,e;return this.parent=a,e=c.apply(this,arguments),d===b?delete this.parent:this.parent=d,e},c)},D=function(a){var b=a.name;if(w[b])throw Error('Adding duplicate mutator "'+b+'".');w[b]=a,a.propTest=RegExp("^__"+b+"_"),a.propPrefix="__"+b+"_",a.onCreate&&x.push(a),a.onPropAdd&&y.push(a),a.onPropRemove&&z.push(a),a.onInit&&A.push(a)},E=function(a){},F=function(a,b,d,e){if(e===g[d])return;var f=!1;r(y,function(c){if(c.propTest.test(d))return d===c.propPrefix?r(e,function(d,e){c.onPropAdd.call(c,a,b,e,d)}):c.onPropAdd.call(c,a,b,d.replace(c.propTest,""),e),f=!0,!1});if(f)return;var h=b[c][d],i=a[c];i[d]=j(e)&&!e.__isclass_&&j(h)?C(h,e):e,j(e)&&r(a.subclass,function(a){j(a[c][d])&&!a[c][d].__original_&&(a[c][d]=C(i[d],a[c][d]))})},G=function(a,b){if(a[c][b]&&a[c][b]===g[b])return;var d=!1;r(z,function(c){if(c.propTest.test(b))return c.onPropRemove.call(c,a,b.replace(c.propTest,"")),d=!0,!1});if(d)return;if(!j(a[c][b])){a[c][b]=null;try{delete a[c][b]}catch(e){}return}r(a.subclass,function(a){a[c][b]&&j(a[c][b])&&j(a[c][b].__original_)&&(a[c][b]=a[c][b].__original_)}),a[c][b]=null;try{delete a[c][b]}catch(e){}},H=function(){var a=B,d={},e=[],f=arguments,g=f.length;g===1?d=f[0]:g===2?(!f[0].__isclass_&&!k(f[0])?e=n(f[0]):a=f[0],d=f[1]):(a=f[0],e=n(f[1]),d=f[2]),!a.__isclass_&&!d.init&&(d.init=a);var h=function(){var a,c,d;if(!this||!this.init||!(this instanceof h))return h.invoke.apply(h,arguments);for(c=0,d=A.length;c<d;c++)A[c].onInit.call(A[c],this,h);a=this.init.apply(this,arguments);if(a!==b)return a};delete d.applicate,h.applicate=function(a){var b=function(){return h.apply(this,a)};return b[c]=h[c],new b},h.invoke=d.invoke||(a.invoke&&!a.invoke.__original_?a.invoke:null)||q(function(){return h.applicate(arguments)},!0),delete d.invoke,h.superclass=a,h.subclass=[],h.implement=(a.implement||[]).concat(e),h.extend=h[c].extend=function(){return H.apply(null,[h].concat(o(arguments)))};var i=function(){};i[c]=a[c];var l=i[c];return h[c]=new i,a.subclass&&a.subclass.push(h),d.invoke=function(a,b){if(a in l&&a!=="invoke"&&j(l[a])){var c=this.invoke,d;return this.invoke=l.invoke,d=l[a].apply(this,b||[]),this.invoke=c,d}throw Error('Function "'+a+'" of parent class being invoked is undefined.')},h.addProperty=function(a,c,d){return d=d||"",c===b?r(m(a),function(b){F(h,i,d+b,a[b])}):F(h,i,d+a,c),h},h.removeProperty=function(a){return G(h,a),h},e.length!==0&&r(e,function(a){var e=a.__isclass_?a[c]:a;r(m(e),function(a){h[c][a]===b&&d[a]===b&&h.addProperty(a,e[a])})}),r(x,function(b){b.onCreate.call(b,h,a)}),h.addProperty(d),h[c].constructor=h,h[c].self=h,h.__isclass_=!0,h};D({name:"static",onCreate:function(a,b){var c=this.propPrefix;a.addStaticProperty=function(b,d){return a.addProperty(b,d,c)},a.removeStaticProperty=function(b){return a.removeProperty(c+b)}},onPropAdd:function(a,b,c,d){if(v.test(c))return;a[c]=j(d)&&!d.__isclass_?q(function(){return d.apply(a,arguments)},d):d},onPropRemove:function(a,b){if(v.test(b))return;a[b]=null;try{delete a[b]}catch(c){}}}),D({name:"nowrap",onCreate:function(a,b){var c=this.propPrefix;a.addUnwrappedProperty=function(b,d){return a.addProperty(b,d,c)}},onPropAdd:function(a,b,d,e){a[c][d]=e}}),D({name:"alias",onCreate:function(a,b){var c=this.propPrefix;a.addAliasedProperty=function(b,d){return a.addProperty(b,d,c)}},onPropAdd:function(a,b,c,d){F(a,b,c,function(){return this[d].apply(this,arguments)})}});var I=H({init:function(a,b,c){if(!a)throw Error("Cannot create Observer without class context.");this.context=a,this.name=b,this.events=[],this.writable=!0,this.delay=0,this._debounce=null,c!==null&&typeof c=="object"?(this.getter=j(c.get)?c.get:null,this.setter=j(c.set)?c.set:null,this.value=c.value,this.writable=typeof c.writable=="boolean"?c.writable:!0,this.delay=typeof c.delay=="number"?c.delay:0):this.value=c},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(a){var b=this.value;return this.writable?(this.value=this.setter?this.setter.call(this.context,a,b):a,this.value!==b&&this.emit(),this.context):this.context},emit:function(){var b=this;return this.delay>0?(this._debounce!==null&&a.clearTimeout(this._debounce),this._debounce=a.setTimeout(function(){this._debounce=null,b.triggerEmit()},this.delay)):this.triggerEmit(),this.context},triggerEmit:function(){var a=0,b=this.events.length;for(;a<b;a++)this.events[a].call(this.context,this.value)},addListener:function(a){if(!j(a))throw Error("Observer.addListener only takes instances of Function");return this.events.push(a),this.context},removeListener:function(a){if(!j(a))throw Error("Observer.removeListener only takes instances of Function");var b=p(this.events,a);return b<0?this.context:(this.events.splice(b,1),this.context)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}});D({name:"observable",onCreate:function(a,b){var c=this;a.observable=u({},b.observable||{}),a.addObservableProperty=function(b,d){return a.addProperty(b,d,c.propPrefix)},a.removeObservableProperty=function(b){return a.removeProperty(c.propPrefix+b)}},onPropAdd:function(a,b,c,d){a.observable[c]=d,r(a.subclass,function(a){i.call(a.observable,c)||a.addObservableProperty(c,d)})},onPropRemove:function(a,b){var c=a.observable[b];r(a.subclass,function(a){a.observable[b]===c&&a.removeObservableProperty(b)}),a.observable[b]=null;try{delete a.observable[b]}catch(d){}},onInit:function(a,b){var c,d=b.observable||null;if(d===null)return;for(c in d)i.call(d,c)&&(a[c]=new I(a,c,d[c]))}});var J={},K="GLOBAL",L,M,N,O,P=function(a,b){return r(a,function(a){b[a]||(b[a]={}),b=b[a]}),b},Q=function(a,b,c){if(typeof b=="string"){c=a[b]||O().get(b)||null;if(!c)throw Error("Invalid parent class ["+b+"] specified.");return c}return l(b)?s(b,function(b){return Q(a,b)}):b},R=H({init:function(a){this.ref={},this.name=a},create:function(){var a=o(arguments),b=a.shift(),d=b.split("."),e=d.pop(),f=this,g=P(d,f),h=f.ref,i=H.apply(null,s(a,function(a){return Q(h,a)}));return i._name_=e,i._namespace_=b,i.extend=i[c].extend=function(){return H.apply(null,[i].concat(s(arguments,function(a){return Q(h,a)})))},i.getNamespace=function(){return f},i.toString=function(){return"[object "+b+"]"},g[e]=i,h[b]=i,i},destroy:function(a){var b,c=a.split("."),d=c.pop(),e=this,f=this,g=this.ref;return r(c,function(a){if(!f[a])return f=null,!1;f=f[a]}),f?(b=f[d],b?(r(b.subclass,function(a){e.destroy(a._namespace_)}),b.superclass.subclass&&(b.superclass.subclass=t(b.superclass.subclass,b)),r(g,function(b,c){c!==a&&c.indexOf(a)===0&&e.destroy(b._namespace_)}),delete f[d],delete g[a],this):this):this},exists:function(a){return!!this.ref[a]},get:function(a,b){return j(b)?(this.ref[a]?b(this.ref[a]):this.load(a,b),this):this.ref[a]||this.name!==K&&O().get(a)||null},load:function(a,b){return b&&b(this.ref[a]||null),this},setAutoloader:function(a){if(!j(a))throw Error("Namespace.setAutoloader only takes instances of Function");return this.load=a,this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});L=function(a){return a instanceof R?a:(a=a||K,J[a]||(J[a]=new R(a)),J[a])},M=function(a){a instanceof R&&(a=a.name);if(a===K)return;delete J[a]},N=function(a){var b=a.split("."),c=b.length,d;while((d=b.slice(0,c--).join("."))!=="")if(J[d])return J[d];return null},O=function(){return L(K)};var S="/",T=H({invoke:function(){var a=o(arguments),b=a.length,c,d;if(b===0)return L();if(typeof a[0]=="string")return b===1?(d=a[0].split(S),c=L(d[0]),d[1]?c.get(d[1]):c):b===2&&typeof a[1]=="string"?L(a[0]).get(a[1]):(d=a.shift().split(S),c=L(d[0]),d[1]&&a.unshift(d[1]),c.create.apply(c,a));return H.apply(null,a)},init:function(){var a=o(arguments),b,c;if(a.length<1)throw Error("Classify object cannot be instantiated!");return b=l(a[a.length-1])?a.pop():[],c=T.invoke.apply(null,a),c.__isclass_?c.applicate(b):c}});u(T,{version:"0.9.6",create:H,Namespace:R,getNamespace:L,destroyNamespace:M,testNamespace:N,getGlobalNamespace:O,Observer:I,extend:u,provide:function(b,c){return P(b.split("."),c||a||{})}});if(typeof a.module!="undefined"&&a.module.exports)a.module.exports=T,T.Classify=T;else if(typeof a.define=="function"&&a.define.amd)a.define("classify",function(){return T});else{var U=a.Classify;a.Classify=T,T.noConflict=function(){return U===b?delete a.Classify:a.Classify=U,T}}})(this);