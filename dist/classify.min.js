/*!
 * Classify JavaScript Library v0.4.0
 * http://www.closedinterval.com/
 *
 * Copyright 2011, Wei Kin Huang
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Sun Jul 24 17:09:17 EDT 2011
 */
(function(a,b){"use strict";var c="prototype",d="string",e=function(){var a;for(a in{toString:1})if(a==="toString")return!1;return!0}(),f=e?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],g=f.length,h=Object[c],i=h.toString,j=function(a){return typeof a=="function"},k=function(a){return i.call(a)==="[object Array]"},l=function(a){var b=[],c;for(c in a)b.push(c);if(e)for(c=0;c<g;c++)a.hasOwnProperty(f[c])&&b.push(f[c]);return b},m=function(a){return k(a)?a:[a]},n=function(a){return Array[c].slice.call(a,0)},o=function(a,b){a.__original_=b;return a},p=function(a,c,d){if(!a)return a;var e,f=0,g=a.length;if(g===b||j(a)){for(e in a)if(c.call(d||a[e],a[e],e,a)===!1)break}else for(e=a[0];f<g;e=a[++f])if(c.call(d||e,e,f,a)===!1)break;return a},q=function(a,b){var c=[];p(a,function(d,e){c[c.length]=b(d,e,a)});return c},r=function(a,b){var c=[];p(a,function(a){a!==b&&(c[c.length]=a)});return c},s=/^__static_/,t=function(){var a=function(){};a[c].init=function(){},a.superclass=null,a.subclass=[],a.implement=[],a[c].constructor=t,a[c].self=t,a.__isclass_=!0;return a}(),u=function(a,d,e,f){if(f!==h[e])if(s.test(e))a[e.replace(s,"")]=j(f)?o(function(){return f.apply(a,arguments)},f):f;else{var g=d[c][e];a[c][e]=j(f)&&j(g)?o(function(){var a=this.parent,c;this.parent=g,c=f.apply(this,arguments),a===b?delete this.parent:this.parent=a;return c},f):f}},v=function(){var a=t,d={},e=[],f=arguments,g=f.length;g===1?d=f[0]:g===2?(f[0].__isclass_?a=f[0]:e=m(f[0]),d=f[1]):(a=f[0],e=m(f[1]),d=f[2]);var h=function(){if(!this||!this.init)return h.invoke.apply(h,arguments);var a=this.init.apply(this,arguments);if(a!==b)return a};delete d.applicate,h.applicate=function(a){var b=function(){return h.apply(this,a)};b[c]=h[c];return new b},h.invoke=d.invoke||a.invoke||function(){return h.applicate(arguments)},delete d.invoke,h.superclass=a,h.subclass=[],h.implement=a.implement.concat(e),h.Extend=h[c].Extend=function(a){return v(h,a)};var i=function(){};i[c]=a[c];var k=i[c];h[c]=new i,a.subclass.push(h),d.invoke=function(a,b){if(a in k&&a!=="invoke"&&j(k[a])){var c=this.invoke,d;this.invoke=k.invoke,d=k[a].apply(this,b||[]),this.invoke=c;return d}throw'Function "'+a+'" of parent class being invoked is undefined.'},h.addProperty=function(a,c,d){d=d||"",c===b?p(l(a),function(b){u(h,i,d+b,a[b])}):u(h,i,d+a,c);return h},h.addStaticProperty=function(a,b){return h.addProperty(a,b,"__static_")},e.length!==0&&p(e,function(a){var e=a.__isclass_?a[c]:a;p(l(e),function(a){h[c][a]===b&&d[a]===b&&h.addProperty(a,e[a])})}),h.addProperty(d),h[c].constructor=h,h[c].self=h,h.__isclass_=!0;return h},w={},x="GLOBAL",y,z,A,B,C=function(a,b){p(a,function(a){b[a]||(b[a]={}),b=b[a]});return b},D=function(a,b,c){if(typeof b===d){c=a[b]||B().get(b)||null;if(!c)throw"Invalid parent class specified.";return c}return k(b)?q(b,function(b){return D(a,b)}):b},E=v({init:function(a){this.ref={},this.name=a},create:function(){var a=n(arguments),b=a.shift(),c=b.split("."),d=c.pop(),e=this,f=C(c,e),g=e.ref,h=v.apply(null,q(a,function(a){return D(g,a)}));h._name_=d,h._namespace_=b,h.getNamespace=function(){return e},h.toString=function(){return"[object "+b+"]"},f[d]=h,g[b]=h;return h},destroy:function(a){var b,c=a.split("."),d=c.pop(),e=this,f=this,g=this.ref;p(c,function(a){if(!f[a]){f=null;return this}f=f[a]});if(!f)return this;b=f[d],p(b.subclass,function(a){e.destroy(a._namespace_)}),b.superclass.subclass=r(b.superclass.subclass,b),p(g,function(b,c){c!==a&&c.indexOf(a)===0&&e.destroy(b._namespace_)}),delete f[d],delete g[a];return this},exists:function(a){return!!this.ref[a]},get:function(a,b){if(j(b)){this.ref[a]?b(this.ref[a]):this.load(a,b);return this}return this.ref[a]||null},load:function(a,b){b&&b(this.ref[a]||null)},setAutoloader:function(a){if(!j(a))return this;this.load=a;return this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});y=function(a){if(a instanceof E)return a;w[a]||(w[a]=new E(a));return w[a]},z=function(a){delete w[a]},A=function(a){var b=a.split("."),c=b.length,d;while((d=b.slice(0,c--).join("."))!=="")if(w[d])return w[d];return null},B=function(){return y(x)};var F=v({invoke:function(){var a=n(arguments),b,c=a.length;if(typeof a[0]===d){if(c===1)return y(a[0]);if(c===2&&typeof a[1]===d)return y(a[0]).ref[a[1]];b=y(a.shift());return b.create.apply(b,a)}return v.apply(null,a)},init:function(){var a=n(arguments),b=a.pop(),c;if(a.length<1)throw"Classify object cannot be instantiated!";c=F.invoke.apply(null,a);if(c.__isclass_)return c.applicate(b);return c}});F.create=v,F.getNamespace=y,F.destroyNamespace=z,F.testNamespace=A,F.getGlobalNamespace=B,F.provide=function(b,c){return C(b,c||a||{})};if(typeof module!="undefined"&&module.exports)module.exports=F,F.Classify=F;else{var G=a.Classify;a.Classify=F,F.noConflict=function(){G===b?delete a.Classify:a.Classify=G;return F}}})(this);