/*!
 * Classify JavaScript Library v0.9.8
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Fri, 15 Jun 2012 01:42:51 GMT
 */;(function(e,t){"use strict";var n="prototype",r=!{toString:1}.propertyIsEnumerable("toString"),i=r?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],s=i.length,o=Object[n],u=o.toString,a=o.hasOwnProperty,f=function(e){return typeof e=="function"},l=function(e){return e&&e[n]&&u.call(e)==="[object Function]"},c=Array.isArray||function(e){return u.call(e)==="[object Array]"},h=function(e){var t=[],n;for(n in e)t[t.length]=n;if(r)for(n=0;n<s;++n)e.hasOwnProperty(i[n])&&(t[t.length]=i[n]);return t},p=function(e){return c(e)?e:[e]},d=function(e){return Array[n].slice.call(e,0)},v=Array[n].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n=0,r=e.length;for(;n<r;++n)if(e[n]===t)return n;return-1},m=function(e,t){return e.__original_=t,e},g=function(e,n,r){if(!e)return e;var i,s=0,o=e.length;if(o===t||f(e)){for(i in e)if(n.call(r||e[i],e[i],i,e)===!1)break}else for(i=e[0];s<o;i=e[++s])if(n.call(r||i,i,s,e)===!1)break;return e},y=function(e,t){var n=[];return g(e,function(r,i){n[n.length]=t(r,i,e)}),n},b=function(e,t){var n=[];return g(e,function(e){e!==t&&(n[n.length]=e)}),n},w=function(){var e=d(arguments),t=e.shift();return g(e,function(e){g(h(e),function(n){t[n]=e[n]})}),t},E=/^(?:superclass|subclass|implement|observable|bindings|extend|prototype|applicate|(?:add|remove)(?:Static|Observable|Aliased|Bound)Property)$/,S={},x=[],T=[],N=[],C=[],k=[x,T,N,C],L=["onCreate","onPropAdd","onPropRemove","onInit"],A=function(){var e=function(){};return e[n].init=function(){},e.superclass=null,e.subclass=[],e.implement=[],e[n].constructor=A,e[n].self=A,e.__isclass_=!0,e}(),O=function(e,n){return m(function(){var r=this.parent,i;return this.parent=e,i=n.apply(this,arguments),r===t?delete this.parent:this.parent=r,i},n)},M=function(e,t){if(S[e])throw Error('Adding duplicate mutator "'+e+'".');S[e]=t,t.name=e,t.propTest=RegExp("^__"+e+"_"),t.propPrefix="__"+e+"_",g(L,function(e,n){t[e]&&k[n].push(t)})},_=function(e){var t=S[e];if(!t)throw Error("Removing unknown mutator.");g(L,function(e,n){if(t[e]){var r=v(k[n],t);r>-1&&k[n].splice(r,1)}}),S[e]=null;try{delete S[e]}catch(n){}},D=function(e,t,r,i){if(i===o[r])return;var s=!1;g(T,function(n){if(n.propTest.test(r))return r===n.propPrefix?g(i,function(r,i){n.onPropAdd.call(n,e,t,i,r)}):n.onPropAdd.call(n,e,t,r.replace(n.propTest,""),i),s=!0,!1});if(s)return;var u=t[n][r],a=e[n];a[r]=f(i)&&!i.__isclass_&&f(u)?O(u,i):i,f(i)&&g(e.subclass,function(e){f(e[n][r])&&!e[n][r].__original_&&(e[n][r]=O(a[r],e[n][r]))})},P=function(e,t){var r=!1;g(N,function(n){if(n.propTest.test(t))return n.onPropRemove.call(n,e,t.replace(n.propTest,"")),r=!0,!1});if(r)return;if(!f(e[n][t])){e[n][t]=null;try{delete e[n][t]}catch(i){}return}g(e.subclass,function(e){e[n][t]&&f(e[n][t])&&f(e[n][t].__original_)&&(e[n][t]=e[n][t].__original_)}),e[n][t]=null;try{delete e[n][t]}catch(i){}},H=function(){var e=A,r={},i=[],s=arguments,o=s.length;o===1?r=s[0]:o===2?(!s[0].__isclass_&&!l(s[0])?i=p(s[0]):e=s[0],r=s[1]):(e=s[0],i=p(s[1]),r=s[2]),!e.__isclass_&&!r.init&&(r.init=e);var u=function(){var e,n,r;if(!this||!this.init||!(this instanceof u))return u.invoke.apply(u,arguments);for(n=0,r=C.length;n<r;n++)C[n].onInit.call(C[n],this,u);e=this.init.apply(this,arguments);if(e!==t)return e};delete r.applicate,u.applicate=function(e){var t=function(){return u.apply(this,e)};return t[n]=u[n],new t},u.invoke=r.invoke||(e.invoke&&!e.invoke.__original_?e.invoke:null)||m(function(){return u.applicate(arguments)},!0),delete r.invoke,u.superclass=e,u.subclass=[],u.implement=(e.implement||[]).concat(i),u.extend=u[n].extend=function(){return H.apply(null,[u].concat(d(arguments)))};var a=function(){};a[n]=e[n];var c=a[n];return u[n]=new a,e.subclass&&e.subclass.push(u),r.invoke=function(e,t){if(e in c&&e!=="invoke"&&f(c[e])){var n=this.invoke,r;return this.invoke=c.invoke,r=c[e].apply(this,t||[]),this.invoke=n,r}throw Error('Function "'+e+'" of parent class being invoked is undefined.')},u.addProperty=function(e,n,r){return r=r||"",n===t?g(h(e),function(t){D(u,a,r+t,e[t])}):D(u,a,r+e,n),u},u.removeProperty=function(e){return P(u,e),u},i.length!==0&&g(i,function(e){var i=e.__isclass_?e[n]:e;g(h(i),function(e){u[n][e]===t&&r[e]===t&&u.addProperty(e,i[e])})}),g(x,function(t){t.onCreate.call(t,u,e)}),u.addProperty(r),u[n].constructor=u,u[n].self=u,u.__isclass_=!0,u};M("static",{onCreate:function(e,t){var n=this.propPrefix;e.addStaticProperty=function(t,r){return e.addProperty(t,r,n)},e.removeStaticProperty=function(t){return e.removeProperty(n+t)}},onPropAdd:function(e,t,n,r){if(E.test(n))return;e[n]=f(r)&&!r.__isclass_?m(function(){return r.apply(e,arguments)},r):r},onPropRemove:function(e,t){if(E.test(t))return;e[t]=null;try{delete e[t]}catch(n){}}}),M("nowrap",{onCreate:function(e,t){var n=this.propPrefix;e.addUnwrappedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,r,i){e[n][r]=i}}),M("alias",{onCreate:function(e,t){var n=this.propPrefix;e.addAliasedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,n,r){D(e,t,n,function(){return this[r].apply(this,arguments)})}}),M("bind",{onCreate:function(e,t){var n=this;e.bindings=(t.bindings||[]).slice(0),e.addBoundProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeBoundProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){var i=v(e.bindings,n);i<0&&f(r)&&!r.__isclass_&&e.bindings.push(n),D(e,t,n,r)},onPropRemove:function(e,t){var r=v(e.bindings,t);if(r<0)return;e.bindings.splice(r,1),g(e.subclass,function(e){v(e.bindings,t)>-1&&!e[n].hasOwnProperty(t)&&e.removeBoundProperty(t)}),P(e,t)},onInit:function(e,t){var r=t.bindings||null;if(r===null||r.length===0)return;g(r,function(r){e[r]=function(){var i=d(arguments);return i.unshift(this),t[n][r].apply(e,i)}})}});var B=H({init:function(e,t,n){if(!e)throw Error("Cannot create Observer without class context.");this.context=e,this.name=t,this.events=[],this.writable=!0,this.delay=0,this._debounce=null,n!==null&&typeof n=="object"?(this.getter=f(n.get)?n.get:null,this.setter=f(n.set)?n.set:null,this.value=n.value,this.writable=typeof n.writable=="boolean"?n.writable:!0,this.delay=typeof n.delay=="number"?n.delay:0):this.value=n},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(e){var t=this.value,n=this.context;return this.writable?(this.value=this.setter?this.setter.call(n,e,t):e,this.value!==t&&this.emit(),n):n},emit:function(){var t=this,n=d(arguments);return this.delay>0?(this._debounce!==null&&e.clearTimeout(this._debounce),this._debounce=e.setTimeout(function(){t._debounce=null,t._triggerEmit(n)},this.delay)):this._triggerEmit(n),this.context},_triggerEmit:function(e){var t=0,n=this.events.length,r=this.context,i=this.events;e.unshift(this.value);for(;t<n;++t)i[t].apply(r,e)},addListener:function(e){if(!f(e))throw Error("Observer.addListener only takes instances of Function");return this.events[this.events.length]=e,this.context},once:function(e){if(!f(e))throw Error("Observer.once only takes instances of Function");var t=this,n=function(){t.removeListener(n),e.apply(this,arguments)};return n.listener=e,this.addListener(n),this.context},removeListener:function(e){if(!f(e))throw Error("Observer.removeListener only takes instances of Function");var t=this.context,n=this.events,r=-1,i=0,s=n.length;for(;i<s;++i)if(n[i]===e||n[i].listener&&n[i].listener===e){r=i;break}return r<0?t:(n.splice(i,1),t)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}});B[n].on=B[n].addListener,M("observable",{onCreate:function(e,t){var n=this;e.observable=w({},t.observable||{}),e.addObservableProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeObservableProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){e.observable[n]=r,g(e.subclass,function(e){a.call(e.observable,n)||e.addObservableProperty(n,r)})},onPropRemove:function(e,t){var n=e.observable[t];g(e.subclass,function(e){e.observable[t]===n&&e.removeObservableProperty(t)}),e.observable[t]=null;try{delete e.observable[t]}catch(r){}},onInit:function(e,t){var n,r=t.observable||null;if(r===null)return;for(n in r)a.call(r,n)&&(e[n]=new B(e,n,r[n]))}});var j={},F="GLOBAL",I,q,R,U,z=function(e,t){return g(e,function(e){t[e]||(t[e]={}),t=t[e]}),t},W=function(e,t,n){if(typeof t=="string"){n=e[t]||U().get(t)||null;if(!n)throw Error("Invalid parent class ["+t+"] specified.");return n}return c(t)?y(t,function(t){return W(e,t)}):t},X=H({init:function(e){this.ref={},this.name=e},create:function(){var e=d(arguments),t=e.shift(),r=t.split("."),i=r.pop(),s=this,o=z(r,s),u=s.ref,a=H.apply(null,y(e,function(e){return W(u,e)}));return a._name_=i,a._namespace_=t,a.extend=a[n].extend=function(){return H.apply(null,[a].concat(y(arguments,function(e){return W(u,e)})))},a.getNamespace=function(){return s},a.toString=function(){return"[object "+t+"]"},o[i]=a,u[t]=a,a},destroy:function(e){var t,n=e.split("."),r=n.pop(),i=this,s=this,o=this.ref;return g(n,function(e){if(!s[e])return s=null,!1;s=s[e]}),s?(t=s[r],t?(g(t.subclass,function(e){i.destroy(e._namespace_)}),t.superclass.subclass&&(t.superclass.subclass=b(t.superclass.subclass,t)),g(o,function(t,n){n!==e&&n.indexOf(e)===0&&i.destroy(t._namespace_)}),delete s[r],delete o[e],this):this):this},exists:function(e){return!!this.ref[e]},get:function(e,t){return f(t)?(this.ref[e]?t(this.ref[e]):this.load(e,t),this):this.ref[e]||this.name!==F&&U().get(e)||null},load:function(e,t){return t&&t(this.ref[e]||null),this},setAutoloader:function(e){if(!f(e))throw Error("Namespace.setAutoloader only takes instances of Function");return this.load=e,this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});I=function(e){return e instanceof X?e:(e=e||F,j[e]||(j[e]=new X(e)),j[e])},q=function(e){e instanceof X&&(e=e.name);if(e===F)return;delete j[e]},R=function(e){var t=e.split("."),n=t.length,r;while((r=t.slice(0,n--).join("."))!=="")if(j[r])return j[r];return null},U=function(){return I(F)};var V="/",$=H({invoke:function(){var e=d(arguments),t=e.length,n,r;if(t===0)return I();if(typeof e[0]=="string")return t===1?(r=e[0].split(V),n=I(r[0]),r[1]?n.get(r[1]):n):t===2&&typeof e[1]=="string"?I(e[0]).get(e[1]):(r=e.shift().split(V),n=I(r[0]),r[1]&&e.unshift(r[1]),n.create.apply(n,e));return H.apply(null,e)},init:function(){var e=d(arguments),t,n;if(e.length<1)throw Error("Classify object cannot be instantiated!");return t=c(e[e.length-1])?e.pop():[],n=$.invoke.apply(null,e),n.__isclass_?n.applicate(t):n}});w($,{version:"0.9.8",create:H,Namespace:X,getNamespace:I,destroyNamespace:q,testNamespace:R,getGlobalNamespace:U,Observer:B,addMutator:M,removeMutator:_,extend:w,provide:function(t,n){return z(t.split("."),n||e||{})}});if(typeof module!="undefined"&&module.exports)module.exports=$,$.Classify=$;else if(typeof e.define=="function"&&e.define.amd)e.define("classify",function(){return $});else{var J=e.Classify;e.Classify=$,$.noConflict=function(){return J===t?delete e.Classify:e.Classify=J,$}}})(this);