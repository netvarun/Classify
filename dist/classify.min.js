/*!
 * Classify JavaScript Library v0.2.0
 * http://www.closedinterval.com/
 *
 * Copyright 2011, Wei Kin Huang
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Thu Jun 30 13:49:35 EDT 2011
 */
(function(a,b){"use strict";var c="prototype",d=function(){var a;for(a in{toString:1})if(a==="toString")return!1;return!0}(),e=d?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],f=e.length,g=Object[c],h=g.toString,i=function(a){return typeof a=="function"},j=function(a){return h.call(a)==="[object Array]"},k=function(a){var b=[],c;for(c in a)b.push(c);if(d)for(c=0;c<f;c++)a.hasOwnProperty(e[c])&&b.push(e[c]);return b},l=function(a){return j(a)?a:[a]},m=function(a){return Array[c].slice.call(a,0)},n=function(a,b){a.__original_=b;return a},o=function(a,c,d){if(!a)return a;var e,f=0,g=a.length;if(g===b||i(a)){for(e in a)if(c.call(d||a[e],a[e],e,a)===!1)break}else for(e=a[0];f<g;e=a[++f])if(c.call(d||e,e,f,a)===!1)break;return a},p=function(a,b){var c=[];o(a,function(d,e){c[c.length]=b(d,e,a)});return c},q=function(a,b){var c=[];o(a,function(a){a!==b&&(c[c.length]=a)});return c},r=/^__static_/,s=function(){var a=function(){};a[c]._construct_=function(){},a.superclass=null,a.subclass=[],a.implement=[],a[c].constructor=s,a[c]._self_=s,a.__isclass_=!0;return a}(),t=function(a,d,e,f){if(f!==g[e])if(r.test(e))a[e.replace(r,"")]=i(f)?n(function(){return f.apply(a,arguments)},f):f;else{var h=d[c][e];a[c][e]=i(f)&&i(h)?n(function(){var a=this._parent_,c;this._parent_=h,c=f.apply(this,arguments),a===b?delete this._parent_:this._parent_=a;return c},f):f}},u=function(){var a=s,d={},e=[],f=arguments,g=f.length;g===1?d=f[0]:g===2?(f[0].__isclass_?a=f[0]:e=l(f[0]),d=f[1]):(a=f[0],e=l(f[1]),d=f[2]);var h=function(){if(!this||!this._construct_)return h._invoke_.apply(h,arguments);var a=this._construct_.apply(this,arguments);if(a!==b)return a};delete d._apply_,h._apply_=function(a){var b=function(){return h.apply(this,a)};b[c]=h[c];return new b},h._invoke_=d._invoke_||function(){return h._apply_(arguments)},delete d._invoke_,h.superclass=a,h.subclass=[],h.implement=a.implement.concat(e),h.Extend=h[c].Extend=function(a){return u(h,a)};var j=function(){};j[c]=a[c];var m=j[c];h[c]=new j,a.subclass.push(h),d._invoke_=function(a,b){if(a in m&&a!=="_invoke_"&&i(m[a])){var c=this._invoke_,d;this._invoke_=m._invoke_,d=m[a].apply(this,b||[]),this._invoke_=c;return d}throw'Function "'+a+'" of parent class being invoked is undefined.'},h.addProperty=function(a,c,d){d=d||"",c===b?o(k(a),function(b){t(h,j,d+b,a[b])}):t(h,j,d+a,c);return h},h.addStaticProperty=function(a,b){return h.addProperty(a,b,"__static_")},e.length!==0&&o(e,function(a){var e=a.__isclass_?a[c]:a;o(k(e),function(a){h[c][a]===b&&d[a]===b&&h.addProperty(a,e[a])})}),h.addProperty(d),h[c].constructor=h,h[c]._self_=h,h.__isclass_=!0;return h},v={},w=function(a,b){o(a,function(a){b[a]||(b[a]={}),b=b[a]});return b},x=function(a,b){if(typeof b=="string"){if(!a[b])throw"Invalid parent class specified.";return a[b]}return j(b)?p(b,function(b){return x(a,b)}):b},y=u({_construct_:function(a){this.ref={},this.name=a},create:function(){var a=m(arguments),b=a.shift(),c=b.split("."),d=c.pop(),e=this,f=w(c,e),g=e.ref,h=u.apply(null,p(a,function(a){return x(g,a)}));h._name_=d,h._namespace_=b,h.getNamespace=function(){return e},h.toString=function(){return"[object "+b+"]"},f[d]=h,g[b]=h;return h},destroy:function(a){var b,c=a.split("."),d=c.pop(),e=this,f=this,g=this.ref;o(c,function(a){if(!f[a]){f=null;return this}f=f[a]});if(!f)return this;b=f[d],o(b.subclass,function(a){e.destroy(a._namespace_)}),b.superclass.subclass=q(b.superclass.subclass,b),o(g,function(b,c){c!==a&&c.indexOf(a)===0&&e.destroy(b._namespace_)}),delete f[d],delete g[a];return this},exists:function(a){return!!this.ref[a]},get:function(a,b){b&&b(this.ref[a]||null);return this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}}),z=function(a){v[a]||(v[a]=new y(a));return v[a]},A=function(a){delete v[a]},B=u({_invoke_:function(){var a=m(arguments),b,c=a.length;if(typeof a[0]=="string"){if(c===1)return z(a[0]);if(c===2&&typeof a[1]=="string")return z(a[0]).ref[a[1]];b=z(a.shift());return b.create.apply(b,a)}return u.apply(null,a)},_construct_:function(){var a=m(arguments),b=a.pop(),c;if(a.length<1)throw"Classify object cannot be instantiated!";c=B._invoke_.apply(null,a);if(c.__isclass_)return c._apply_(b);return c}});B.create=u,B.getNamespace=z,B.destroyNamespace=A,typeof module!="undefined"&&module.exports?(module.exports=B,B.Classify=B):a.Classify=B})(this);