/*!
 * Classify JavaScript Library v0.10.0
 * http://www.closedinterval.com/
 *
 * Copyright 2011-2012, Wei Kin Huang
 * Classify is freely distributable under the MIT license.
 *
 * Date: Tue, 03 Jul 2012 20:52:26 GMT
 */;(function(e,t){"use strict";var n="prototype",r=!{toString:null}.propertyIsEnumerable("toString"),i=r?"hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","):[],s=i.length,o=Object[n],u=o.toString,a=o.hasOwnProperty,f=/^(?:boolean|number|string|undefined)$/,l=function(e){return e===null||f.test(typeof e)},c=function(e){return typeof e=="function"},h=function(e){return e&&e[n]&&u.call(e)==="[object Function]"},p=Array.isArray||function(e){return u.call(e)==="[object Array]"},d=/^\s*function\s+.+?\(.*?\)\s*\{\s*\[native code\]\s*\}\s*$/,v=function(e){return c(e)&&d.test(e+"")},m=function(e){var t=[],n;for(n in e)t[t.length]=n;if(r)for(n=0;n<s;++n)a.call(e,i[n])&&(t[t.length]=i[n]);return t},g=function(e){return p(e)?e:[e]},y=function(e){return Array[n].slice.call(e,0)},b=Array[n].indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n=0,r=e.length;for(;n<r;++n)if(e[n]===t)return n;return-1},w=function(e,t){return e.__original_=t,e},E=function(e,n,r){if(!e)return e;var i,s=0,o=e.length;if(o===t||c(e)){for(i in e)if(n.call(r||e[i],e[i],i,e)===!1)break}else for(i=e[0];s<o;i=e[++s])if(n.call(r||i,i,s,e)===!1)break;return e},S=function(e,t){var n=[];return E(e,function(r,i){n[n.length]=t(r,i,e)}),n},x=function(e,t){var n=[];return E(e,function(e){e!==t&&(n[n.length]=e)}),n},T=function(){var e=y(arguments),t=e.shift();return E(e,function(e){E(m(e),function(n){t[n]=e[n]})}),t},N=/^(?:superclass|subclass|implement|observable|bindings|extend|prototype|applicate|(?:add|remove)(?:Static|Observable|Aliased|Bound)Property)$/,C=/^__/,k={},L=[],A=[],O=[],M=[],_=[L,A,O,M],D=["onCreate","onPropAdd","onPropRemove","onInit"],P=v(Object.create)?Object.create:function(e,t){var r=function(){};return r[n]=e,new r},H=function(e,t,n){e[t]=n},B=function(){var e=function(){};return e[n].init=function(){},e.superclass=null,e.subclass=[],e.implement=[],e[n].constructor=B,e[n].self=B,e.__isclass_=!0,e}(),j=function(e,n){return w(function(){var r=this.parent,i;return this.parent=e,i=n.apply(this,arguments),r===t?delete this.parent:this.parent=r,i},n)},F=function(e,t){if(k[e])throw Error('Adding duplicate mutator "'+e+'".');k[e]=t,t.name=e,t.propTest=RegExp("^__"+e+"_"),t.propPrefix="__"+e+"_",E(D,function(e,n){t[e]&&_[n].push(t)})},I=function(e){var t=k[e];if(!t)throw Error("Removing unknown mutator.");E(D,function(e,n){if(t[e]){var r=b(_[n],t);r>-1&&_[n].splice(r,1)}}),k[e]=null;try{delete k[e]}catch(n){}},q=function(e,t,r,i){var s,u,a;if(i===o[r])return;if(C.test(r)){s=!1,E(A,function(n){if(n.propTest.test(r))return r===n.propPrefix?E(i,function(r,i){n.onPropAdd.call(n,e,t,i,r)}):n.onPropAdd.call(n,e,t,r.replace(n.propTest,""),i),s=!0,!1});if(s)return}u=t[n][r],a=e[n],H(a,r,c(i)&&!i.__isclass_&&c(u)?j(u,i):i),c(i)&&E(e.subclass,function(e){c(e[n][r])&&!e[n][r].__original_&&H(e[n],r,j(a[r],e[n][r]))})},R=function(e,t){var r=!1;if(C.test(t)){E(O,function(n){if(n.propTest.test(t))return n.onPropRemove.call(n,e,t.replace(n.propTest,"")),r=!0,!1});if(r)return}if(!c(e[n][t])){e[n][t]=null;try{delete e[n][t]}catch(i){}return}E(e.subclass,function(e){e[n][t]&&c(e[n][t])&&c(e[n][t].__original_)&&H(e[n],t,e[n][t].__original_)}),e[n][t]=null;try{delete e[n][t]}catch(i){}},U=function(){var e=B,r={},i=[],s=arguments,o=s.length,u,f;return o===1?r=s[0]:o===2?(!s[0].__isclass_&&!h(s[0])?i=g(s[0]):e=s[0],r=s[1]):(e=s[0],i=g(s[1]),r=s[2]),r=T({},r),!e.__isclass_&&!r.init&&(r.init=e),u=function(){var e,n,r;if(!this||!this.init||!(this instanceof u))return u.invoke.apply(u,arguments);for(n=0,r=M.length;n<r;n++){e=M[n].onInit.call(M[n],this,u);if(e!==t){if(l(e))throw Error("Return values during onInit hook can only be objects.");return e}}e=this.init.apply(this,arguments);if(e!==t){if(l(e))throw Error("Return values for the constructor can only be objects.");return e}},delete r.applicate,u.applicate=function(e){var t=function(){return u.apply(this,e)};return t[n]=u[n],new t},u.invoke=r.invoke||(e.invoke&&c(e.invoke)&&!e.invoke.__original_?e.invoke:null)||w(function(){return u.applicate(arguments)},!0),delete r.invoke,u.superclass=e,u.subclass=[],u.implement=(p(e.implement)?e.implement:[]).concat(i),f=u[n]=P(e[n]),u.extend=f.extend=function(){return U.apply(null,[u].concat(y(arguments)))},e.subclass&&p(e.subclass)&&e.subclass.push(u),r.invoke=function(t,r){if(t in e[n]&&t!=="invoke"&&c(e[n][t])){var i=this.invoke,s;return this.invoke=e[n].invoke,s=e[n][t].apply(this,r||[]),this.invoke=i,s}throw Error('Function "'+t+'" of parent class being invoked is undefined.')},u.addProperty=function(n,r,i){return i=i||"",r===t&&typeof n!="string"?E(m(n),function(t){q(u,e,i+t,n[t])}):q(u,e,i+n,r),u},u.removeProperty=function(e){return R(u,e),u},i.length!==0&&E(i,function(e){var t=e.__isclass_?e[n]:e;E(m(t),function(e){!a.call(f,e)&&!a.call(r,e)&&(r[e]=t[e])})}),E(L,function(t){t.onCreate.call(t,u,e)}),u.addProperty(r),f.constructor=u,f.self=u,u.__isclass_=!0,u};F("static",{onCreate:function(e,t){var n=this.propPrefix;e.addStaticProperty=function(t,r){return e.addProperty(t,r,n)},e.removeStaticProperty=function(t){return e.removeProperty(n+t)}},onPropAdd:function(e,t,n,r){if(N.test(n))return;H(e,n,c(r)&&!r.__isclass_?w(function(){return r.apply(e,arguments)},r):r)},onPropRemove:function(e,t){if(N.test(t))return;e[t]=null;try{delete e[t]}catch(n){}}}),F("nowrap",{onCreate:function(e,t){var n=this.propPrefix;e.addUnwrappedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,r,i){H(e[n],r,i)}}),F("alias",{onCreate:function(e,t){var n=this.propPrefix;e.addAliasedProperty=function(t,r){return e.addProperty(t,r,n)}},onPropAdd:function(e,t,n,r){q(e,t,n,function(){return this[r].apply(this,arguments)})}}),F("bind",{onCreate:function(e,t){var n=this;e.bindings=(t.bindings||[]).slice(0),e.addBoundProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeBoundProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,n,r){var i=b(e.bindings,n);i<0&&c(r)&&!r.__isclass_&&e.bindings.push(n),q(e,t,n,r)},onPropRemove:function(e,t){var r=b(e.bindings,t);if(r<0)return;e.bindings.splice(r,1),E(e.subclass,function(e){b(e.bindings,t)>-1&&!a.call(e[n],t)&&e.removeBoundProperty(t)}),R(e,t)},onInit:function(e,t){var r=t.bindings||null;if(r===null||r.length===0)return;E(r,function(r){H(e,r,function(){var i=y(arguments);return i.unshift(this),t[n][r].apply(e,i)})})}});var z=U({init:function(e,t,n){if(!e)throw Error("Cannot create Observer without class context.");this.context=e,this.name=t,this.events=[],this.writable=!0,this.delay=0,this._debounce=null,n!==null&&typeof n=="object"?(this.getter=c(n.get)?n.get:null,this.setter=c(n.set)?n.set:null,this.value=n.value,this.writable=typeof n.writable=="boolean"?n.writable:!0,this.delay=typeof n.delay=="number"?n.delay:0):this.value=n},get:function(){return this.getter?this.getter.call(this.context,this.value):this.value},set:function(e){var t=this.value,n=this.context;return this.writable?(this.value=this.setter?this.setter.call(n,e,t):e,this.value!==t&&this.emit(),n):n},emit:function(){var t=this,n=y(arguments);return this.delay>0?(this._debounce!==null&&e.clearTimeout(this._debounce),this._debounce=e.setTimeout(function(){t._debounce=null,t._triggerEmit(n)},this.delay)):this._triggerEmit(n),this.context},_triggerEmit:function(e){var t=0,n=this.events.length,r=this.context,i=this.events;e.unshift(this.value);for(;t<n;++t)i[t].apply(r,e)},addListener:function(e){if(!c(e))throw Error("Observer.addListener only takes instances of Function");return this.events[this.events.length]=e,this.context},once:function(e){if(!c(e))throw Error("Observer.once only takes instances of Function");var t=this,n=function(){t.removeListener(n),e.apply(this,arguments)};return n.listener=e,this.addListener(n),this.context},removeListener:function(e){if(!c(e))throw Error("Observer.removeListener only takes instances of Function");var t=this.context,n=this.events,r=-1,i=0,s=n.length;for(;i<s;++i)if(n[i]===e||n[i].listener&&n[i].listener===e){r=i;break}return r<0?t:(n.splice(i,1),t)},removeAllListeners:function(){return this.events=null,this.events=[],this.context},listeners:function(){return this.events},toValue:function(){return this.value&&this.value.toValue?this.value.toValue():this.value},toString:function(){return"[observer "+this.name+"]"}});z[n].on=z[n].addListener,F("observable",{onCreate:function(e,t){var n=this;e.observable=T({},t.observable||{}),e.addObservableProperty=function(t,r){return e.addProperty(t,r,n.propPrefix)},e.removeObservableProperty=function(t){return e.removeProperty(n.propPrefix+t)}},onPropAdd:function(e,t,r,i){e.observable[r]=i,H(e[n],r,null),E(e.subclass,function(e){a.call(e.observable,r)||e.addObservableProperty(r,i)})},onPropRemove:function(e,t){var n=e.observable[t];E(e.subclass,function(e){e.observable[t]===n&&e.removeObservableProperty(t)}),e.observable[t]=null;try{delete e.observable[t]}catch(r){}},onInit:function(e,t){var n,r=t.observable||null;if(r===null)return;for(n in r)a.call(r,n)&&(e[n]=new z(e,n,r[n]))}});var W={},X="GLOBAL",V,$,J,K,Q=function(e,t){return E(e,function(e){t[e]||(t[e]={}),t=t[e]}),t},G=function(e,t,n){if(typeof t=="string"){n=e[t]||K().get(t)||null;if(!n)throw Error("Invalid parent class ["+t+"] specified.");return n}return p(t)?S(t,function(t){return G(e,t)}):t},Y=U({init:function(e){this.ref={},this.name=e},create:function(){var e=y(arguments),t=e.shift(),r=t.split("."),i=r.pop(),s=this,o=Q(r,s),u=s.ref,a=U.apply(null,S(e,function(e){return G(u,e)}));return a._name_=i,a._namespace_=t,a.extend=a[n].extend=function(){return U.apply(null,[a].concat(S(arguments,function(e){return G(u,e)})))},a.getNamespace=function(){return s},a.toString=function(){return"[object "+t+"]"},o[i]=a,u[t]=a,a},destroy:function(e){var t,n=e.split("."),r=n.pop(),i=this,s=this,o=this.ref;return E(n,function(e){if(!s[e])return s=null,!1;s=s[e]}),s?(t=s[r],t?(E(t.subclass,function(e){i.destroy(e._namespace_)}),t.superclass.subclass&&(t.superclass.subclass=x(t.superclass.subclass,t)),E(o,function(t,n){n!==e&&n.indexOf(e)===0&&i.destroy(t._namespace_)}),delete s[r],delete o[e],this):this):this},exists:function(e){return!!this.ref[e]},get:function(e,t){return c(t)?(this.ref[e]?t(this.ref[e]):this.load(e,t),this):this.ref[e]||this.name!==X&&K().get(e)||null},load:function(e,t){return t&&t(this.ref[e]||null),this},setAutoloader:function(e){if(!c(e))throw Error("Namespace.setAutoloader only takes instances of Function");return this.load=e,this},getName:function(){return this.name},toString:function(){return"[namespace "+this.name+"]"}});V=function(e){return e instanceof Y?e:(e=e||X,W[e]||(W[e]=new Y(e)),W[e])},$=function(e){e instanceof Y&&(e=e.name);if(e===X)return;delete W[e]},J=function(e){var t=e.split("."),n=t.length,r;while((r=t.slice(0,n--).join("."))!=="")if(W[r])return W[r];return null},K=function(){return V(X)};var Z="/",et=U({invoke:function(){var e=y(arguments),t=e.length,n,r;if(t===0)return V();if(typeof e[0]=="string")return t===1?(r=e[0].split(Z),n=V(r[0]),r[1]?n.get(r[1]):n):t===2&&typeof e[1]=="string"?V(e[0]).get(e[1]):(r=e.shift().split(Z),n=V(r[0]),r[1]&&e.unshift(r[1]),n.create.apply(n,e));return U.apply(null,e)},init:function(){var e=y(arguments),t,n;if(e.length<1)throw Error("Classify object cannot be instantiated!");return t=p(e[e.length-1])?e.pop():[],n=et.invoke.apply(null,e),n.__isclass_?n.applicate(t):n}});T(et,{version:"0.10.0",create:U,Namespace:Y,getNamespace:V,destroyNamespace:$,testNamespace:J,getGlobalNamespace:K,Observer:z,addMutator:F,removeMutator:I,global:K(),extend:T,provide:function(t,n){return Q(t.split("."),n||e||{})}});if(typeof module!="undefined"&&module.exports)module.exports=et,et.Classify=et;else if(typeof e.define=="function"&&e.define.amd)e.define("classify",function(){return et});else{var tt=e.Classify;e.Classify=et,et.noConflict=function(){return tt===t?delete e.Classify:e.Classify=tt,et}}})(this);